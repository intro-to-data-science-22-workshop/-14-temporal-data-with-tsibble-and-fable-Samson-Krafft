---
title: "Temporal Data with Tsibble and Fable"
author: "Justus v. Samson-Himmelstjerna & Oskar Krafft"
institute: "Hertie School"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: TRUE
    df_print: paged
    number_sections: FALSE
    highlight: tango
    theme: lumen
    toc_depth: 3
    toc_float: true
    css: magic/custom.css 
    self_contained: false
    includes:
      after_body: HTML_sources/footer.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

------------------------------------------------------------------------

### Workshop Packages

```{r, include = T}
library(tsibble)
library(fable)
library(feasts)
library(tsibbledata)
```

### Supplementary Packages

```{r}
library(tidyverse)
library(lubridate)
library(ggplot2)
```

<br>

------------------------------------------------------------------------

### Task 1 - Introduction: Create Tsibble objects

[2 points in total]

TASK DESCRIPTION

a)  Create a tsibble object that has "Year" as index and "Observation" key [0.5 points]

```{r}
my_year_vector <- 2010:2022
my_observation_vector <- rpois(n = 13, lambda = 50)

# Put your code here
y <- tsibble(
  Year = my_year_vector,
  Observation = my_observation_vector,
  index = Year,
  key = Observation
)

y
```

b)  Turn the data.frame into a tsibble object, setting "Month" as index [1.5 points]
```{r}
z <- data.frame(Month = c("2022 Jan", "2022 Feb", "2022 Mar", "2022 Apr", "2022 May"),
                Observations = c(50, 23, 34, 30, 25))

# Put your code here
z %>%
  mutate(Month = yearmonth(Month)) %>%
  as_tsibble(index = Month)
```

------------------------------------------------------------------------

### Task 2 - Forecasting Workflow: Data Preperation and Manipulation  [9 points in total]


For the rest of the workshop, we will be using the "global_economy" dataset from the tsiblledata package.

```{r}
global_economy
```

a)  Identify which countries contain implicit gaps [X points]

```{r}
has_gaps(global_economy, .full = TRUE) %>% 
  filter(.gaps == TRUE)
```
```{r}
has_gaps(global_economy) %>% 
  filter(.gaps == TRUE)
```



```{r}
global_economy %>% 
  count_gaps()
```
```{r}
fill_gaps(global_economy, .full = TRUE)
```

### Task 2 - Forecasting Workflow: Model specification and forecasting  [9 points in total]

```{r}
gdppc <- global_economy %>%
  mutate(GDP_per_capita = GDP / Population)
```

```{r}
gdppc %>%
  filter(Country == "Sweden") %>%
  autoplot(GDP_per_capita) +
  labs(y = "$US", title = "GDP per capita for Sweden")
```
```{r}
fit <- gdppc %>%
  model(trend_model = TSLM(GDP_per_capita ~ trend()))

fit %>% forecast(h = "3 years")
```

```{r}
fit %>%
  forecast(h = "3 years") %>%
  filter(Country == "Sweden") %>%
  autoplot(gdppc) +
  labs(y = "$US", title = "GDP per capita for Sweden")
```

